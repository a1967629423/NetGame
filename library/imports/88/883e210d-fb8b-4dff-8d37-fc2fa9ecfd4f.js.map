{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\site/assets\\script\\site\\SitePeople.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\site","sourcesContent":["import { SiteType } from \"../Enums\";\r\nimport { Vehicle } from \"../vehicle/VehicleMachine\";\r\nimport { SiteSM } from \"./SiteMachine\";\r\nimport { IObpool } from \"../../frame/ObjectPool/ObjectPool\";\r\nimport { Score } from \"../manage/ScoreManage\";\r\nimport { Path } from \"../Path/PathSM\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SitePeople extends cc.Component implements IObpool {\r\n    unuse() {\r\n        Score.ScoreManage.getInstance(Score.ScoreType.people).addScore(1);\r\n    }\r\n    reuse() {\r\n\r\n    }\r\n    recycle(value: any) {\r\n\r\n    }\r\n    // LIFE-CYCLE CALLBACKS:\r\n    // onLoad () {}\r\n    @property({ type: cc.Enum(SiteType) })\r\n    peopleType: SiteType = SiteType.rect\r\n    sourceSite: SiteSM.SiteMachine = null\r\n    start() {\r\n    }\r\n    GetInVehicle(vehicle: Vehicle.VehicleMachine): boolean {\r\n        var dir = vehicle.rundir;\r\n        var nowPath = vehicle.line;\r\n        var hasOtherLineSite: Path.VehiclePath[] = [];\r\n        while (nowPath) {\r\n            var nowSite = dir ? nowPath.nextSite : nowPath.lastSite;\r\n            if (nowSite !== this.sourceSite) {\r\n                if (nowSite.SiteType === this.peopleType) {\r\n                    return true;\r\n                }\r\n                else {\r\n                    nowSite.SiteLines.forEach(P => {\r\n                        if (!(P.mask & 13) && P.PathType !== nowPath.PathType) {\r\n                            if (!hasOtherLineSite.some(v => v.PathType === P.PathType)) {\r\n                                hasOtherLineSite.push(P);\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n            nowPath = dir ? nowPath.NextPath : nowPath.LastPath;\r\n        }\r\n\r\n        //检测从其他线能否到达目的地\r\n        for (var i in hasOtherLineSite) {\r\n\r\n            for (var ndir = true, idx = 0; idx < 2; idx++ , ndir = !ndir) {\r\n                var P = hasOtherLineSite[i];\r\n                while (P) {\r\n                    var nowSite = ndir ? P.nextSite : P.lastSite;\r\n                    if (nowSite.SiteType === this.peopleType && nowSite !== this.sourceSite) {\r\n                        return true;\r\n                    }\r\n                    P = ndir ? P.NextPath : P.LastPath;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    GetOffVehicle(vehicle: Vehicle.VehicleMachine): boolean {\r\n        var hasOtherLineSite: Path.VehiclePath[] = []\r\n        var nowSite = vehicle.nowSite;\r\n        if (nowSite && nowSite !== this.sourceSite && nowSite.SiteType === this.peopleType) {\r\n            return true;\r\n        }\r\n        nowSite.SiteLines.forEach(P => {\r\n            if (!(P.mask & 13)) {\r\n                if (!hasOtherLineSite.some(v => v.PathType === P.PathType)) {\r\n                    hasOtherLineSite.push(P);\r\n                }\r\n            }\r\n        });\r\n        //检测从其他线能否到达目的地\r\n        for (var i in hasOtherLineSite) {\r\n            for (var ndir = true, idx = 0; idx < 2; idx++ , ndir = !ndir) {\r\n                var P = hasOtherLineSite[i];\r\n                while (P) {\r\n                    var nowSite = ndir ? P.nextSite : P.lastSite;\r\n                    if (nowSite.SiteType === this.peopleType && nowSite !== this.sourceSite) {\r\n                        return true;\r\n                    }\r\n                    P = ndir ? P.NextPath : P.LastPath;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n    // update (dt) {}\r\n}\r\n"]}