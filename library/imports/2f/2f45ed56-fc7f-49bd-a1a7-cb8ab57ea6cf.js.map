{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\site/assets\\script\\site\\SiteLine.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\site","sourcesContent":["import { SiteLineSM, SiteSM } from \"./SiteMachine\";\r\nimport { MSM } from \"../../frame/StateMachine/StateMachine\";\r\nimport { MSMDsc } from \"../../frame/StateMachine/StateDec\";\r\nimport { SiteLineType, SiteLineShowState } from \"../Enums\";\r\nimport { IObpool } from \"../../frame/ObjectPool/ObjectPool\";\r\nimport { Vehicle } from \"../vehicle/VehicleMachine\";\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nconst { ccclass, property } = cc._decorator;\r\nconst { mSyncFunc, mSyncAttachFunc } = MSMDsc\r\nexport module SLDSM {\r\n    @MSMDsc.mStateMachine\r\n    @ccclass\r\n    export class SiteLine extends MSM.StateMachine {\r\n        unuse() {\r\n            super.unuse();\r\n            this.NowSite = null;\r\n            this.LastLine = null;\r\n            this.NextLine = null;\r\n            this.removeFromSitelines();\r\n            this.ClearFlag = false;\r\n            this.ChangeFlag = false;\r\n        }\r\n        reuse(LineType:SiteLineType) {\r\n            super.reuse();\r\n            //this.LineType = LineType;\r\n            //this.addSiteLines();\r\n            //this.addSiteLines()\r\n            //this.addSiteLines();\r\n        }\r\n        linkTo(nextLine:SiteLine)\r\n        {\r\n            this.NextLine = nextLine;\r\n            nextLine.LastLine = this;\r\n        }\r\n        recycle(newLine?:SiteLine) {\r\n            this.emit('cleared');\r\n        }\r\n        line: SiteLineSM.SiteLineMachine = null\r\n        static LineVehicles:{lineType:SiteLineType,Vehicles:Vehicle.VehicleMachine[]}[] =[] \r\n        get isShowNode():boolean\r\n        {\r\n            return !!this.node.parent;\r\n        }\r\n        /**\r\n         * 用于保存所有的线\r\n         */\r\n        static SiteLines:{lineType:SiteLineType,lines:SiteLine[]}[] = []\r\n        /**\r\n         * 在线段池中查找指定类型的头端\r\n         * @param lineType 需要查找的类型\r\n         */\r\n        static getBeginLine(lineType:SiteLineType):SiteLine\r\n        {\r\n            var siteline = this.SiteLines.find(value=>value.lineType===lineType);\r\n            var nowLine = null;\r\n            if(siteline&&siteline.lines&&siteline.lines.length>0)\r\n            {\r\n                nowLine = siteline.lines[0];\r\n                while(!nowLine.isBegin)\r\n                {\r\n                    nowLine = nowLine.LastLine;\r\n                }\r\n            }\r\n            return nowLine;\r\n        }\r\n        showState:SiteLineShowState = SiteLineShowState.show;\r\n        onLoad() {\r\n            this.Init();\r\n        }\r\n        addSiteLines()\r\n        {\r\n            var siteline = SiteLine.SiteLines.find(value=>value.lineType===this.LineType);\r\n            if(siteline)\r\n            {\r\n                siteline.lines.push(this);\r\n            }\r\n            else\r\n            {\r\n                SiteLine.SiteLines.push({lineType:this.LineType,lines:[this]});\r\n            }\r\n        }\r\n        removeFromSitelines()\r\n        {\r\n            var siteline = SiteLine.SiteLines.find(value=>value.lineType===this.LineType);\r\n            if(siteline)\r\n            {\r\n                var idx = siteline.lines.findIndex(value=>value===this);\r\n                if(idx>-1)\r\n                siteline.lines.splice(idx,1);\r\n            }\r\n            \r\n        }\r\n        /**\r\n         * 在这条线上注册载具\r\n         * @param v \r\n         */\r\n        registerVehicle(v:Vehicle.VehicleMachine)\r\n        {\r\n            var lvs = SiteLine.LineVehicles.find(value=>value.lineType===this.LineType)\r\n            if(lvs)\r\n            {\r\n                var vs = lvs.Vehicles;\r\n                if(!vs.find(value=>value===v))\r\n                {\r\n                    vs.push(v);\r\n                }\r\n            }\r\n            else\r\n            {\r\n                SiteLine.LineVehicles.push({lineType:this.LineType,Vehicles:[v]});\r\n            }\r\n        }\r\n        /**\r\n         * 在这条线上注销载具\r\n         * @param v \r\n         */\r\n        unregisterVehicle(v:Vehicle.VehicleMachine)\r\n        {\r\n            var lvs = SiteLine.LineVehicles.find(value=>value.lineType===this.LineType)\r\n            if(lvs)\r\n            {\r\n                var vs = lvs.Vehicles;\r\n                var idx = vs.findIndex(value=>value===v)\r\n                if(vs&&idx>-1)vs.splice(idx);\r\n\r\n            }\r\n        }\r\n        private addVehicle(v:Vehicle.VehicleMachine)\r\n        {\r\n            if(v instanceof Vehicle.VehicleMachine)\r\n            {\r\n                this.vehicles.push(v);\r\n            }\r\n        }\r\n        private removeVehicle(v:Vehicle.VehicleMachine)\r\n        {\r\n            if(v instanceof Vehicle.VehicleMachine)\r\n            {\r\n                var idx = this.vehicles.findIndex(value=>value===v);\r\n                if(idx>-1)\r\n                this.vehicles.splice(idx);\r\n                if(this.vehicles.length===0)\r\n                {\r\n                    this.node.emit('vehicleClear');\r\n                }\r\n            }\r\n        }\r\n        \r\n        start()\r\n        {\r\n            //this.caculatePath();\r\n            super.start();\r\n            this.node.on('isRun',this.addVehicle,this);\r\n            this.node.on('runEnd',this.removeVehicle,this);\r\n            this.InitFlag = true;\r\n            \r\n        }\r\n        _ClearFlag:boolean = false;\r\n        _ChangeFlag:boolean = false;\r\n        mask:number = 0;\r\n        get ClearFlag():boolean\r\n        {\r\n            return !!(this.mask&2);\r\n        }\r\n        set ClearFlag(val:boolean\r\n            \r\n            )\r\n        {\r\n            if(val)\r\n            {\r\n                this.mask = this.mask|3;\r\n            }\r\n            else\r\n            {\r\n                this.mask = this.mask&(~3);\r\n            }\r\n        }\r\n        get ChangeFlag():boolean\r\n        {\r\n            return !!(this.mask&4);\r\n        }\r\n        set ChangeFlag(val:boolean)\r\n        {\r\n            if(val)\r\n            {\r\n                this.mask = this.mask|5\r\n            }\r\n            else\r\n            {\r\n                this.mask = this.mask&(~5);\r\n            }\r\n        }\r\n        get HidenFlag():boolean\r\n        {\r\n            return !!(this.mask&1);\r\n        }\r\n        set HidenFlag(val:boolean)\r\n        {\r\n            this.mask = val?this.mask|1:this.mask&(~1);\r\n        }\r\n        vehicles:Vehicle.VehicleMachine[] = [];\r\n        LastLine: SiteLine = null\r\n        NowSite: SiteSM.SiteMachine = null\r\n        _NextLine: SiteLine = null\r\n        InitFlag:boolean = false;\r\n        get NextLine()\r\n        {\r\n            return this._NextLine;\r\n        }\r\n        set NextLine(val)\r\n        {\r\n            this._NextLine = val;\r\n        }\r\n        getAllLength(dir:boolean)\r\n        {\r\n            return dir?this.allLength:this.LastLine?this.LastLine.allLength:0;\r\n        }\r\n        getChangPoint(dir:boolean)\r\n        {\r\n            return dir?this.changPoint:this.LastLine?this.LastLine.changPoint:[];\r\n        }\r\n        allLength: number = 0;\r\n        changPoint: { length: number, point: cc.Vec2, Radian: number }[] = [];\r\n        static SiteInfo: { key: SiteLineType, value: SiteLine[] }[] = []\r\n        _LineType: SiteLineType = SiteLineType.red;\r\n        get LineType(): SiteLineType {\r\n            return this._LineType;\r\n        }\r\n        set LineType(val) {\r\n            this._LineType = val;\r\n        }\r\n        get isEnd(): boolean {\r\n            return !this.NextLine\r\n        }\r\n        get isBegin(): boolean {\r\n            return !this.LastLine\r\n        }\r\n        get nowTypeVehicle():Vehicle.VehicleMachine[]\r\n        {\r\n            var lvs =SiteLine.LineVehicles.find(value=>value.lineType===this.LineType);\r\n            return lvs?lvs.Vehicles:[];\r\n        }\r\n        caculatePath()\r\n        {\r\n            var n = this.NowSite;\r\n            var e = this.NextLine.NowSite;\r\n            var Line = this;\r\n            var { x, y, allLength, firstRadian, lastRadian, rectDir, rectH, rectW } = DMath.pathCalcaulate(n.node.x, n.node.y, e.node.x, e.node.y)\r\n            Line.allLength = allLength;\r\n            Line.changPoint = []\r\n            Line.changPoint.push({ length: rectDir ? rectW : rectH, point: cc.v2(x, y), Radian: firstRadian })\r\n            Line.changPoint.push({ length: allLength, point: e.node.position, Radian: lastRadian });\r\n            this.emit('caculated');\r\n            //nextLine.changPoint = Line.changPoint;\r\n            //nextLine.allLength = allLength;\r\n        }\r\n        onDisable()\r\n        {\r\n            super.onDisable();\r\n            this.node.off('isRun',this.addVehicle,this);\r\n            this.node.off('runEnd',this.removeVehicle,this);\r\n        }\r\n        private __np:cc.Vec2 = null;\r\n        getLocation(progress: number, dir: boolean = true): { position: cc.Vec2, radian: number } {\r\n            var nLine = dir?this:this.LastLine;\r\n            var narr = nLine.changPoint//dir?this.changPoint:this.rchangePoint\r\n            var nprogress = dir ? progress : nLine.allLength - progress;\r\n            var idx = narr.findIndex(value => value.length >= nprogress)\r\n            var cp = narr[idx]\r\n            var lastp = nLine.NowSite.node.position;\r\n            var nLenght = cp.length;\r\n            if (idx >= 1) {\r\n                lastp = narr[idx - 1].point;\r\n                nprogress -= narr[idx-1].length\r\n                nLenght -= narr[idx-1].length\r\n            }\r\n            if(!this.__np)this.__np = cc.v2();\r\n            lastp.lerp(cp.point, nprogress /nLenght,this.__np) //dir?lastp.lerp(cp.point,cl):cp.point.lerp(lastp,cl);\r\n            return { position: this.__np, radian: cp.Radian + (dir ? 0 : Math.PI) };\r\n            // return dir?this.NowSite.node.position.lerp(this.NextLine.NowSite.node.position,progress):this.NextLine.NowSite.node.position.lerp(this.NowSite.node.position,progress);\r\n        }\r\n        // update (dt) {}\r\n    }\r\n    export class SiteLineDisplayState extends MSM.State implements IObpool\r\n    {\r\n        unuse() {\r\n\r\n        }\r\n        reuse() {\r\n\r\n        }\r\n        recycle() {\r\n\r\n        }\r\n        context:SiteLine;\r\n    }\r\n}\r\n/*\r\n    _hitTest (point, listener) {\r\n        let w = this._contentSize.width,\r\n            h = this._contentSize.height,\r\n            cameraPt = _vec2a,\r\n            testPt = _vec2b;\r\n\r\n        let camera = cc.Camera.findCamera(this);\r\n        if (camera) {\r\n            camera.getCameraToWorldPoint(point, cameraPt);\r\n        }\r\n        else {\r\n            cameraPt.set(point);\r\n        }\r\n\r\n        this._updateWorldMatrix();\r\n        math.mat4.invert(_mat4_temp, this._worldMatrix);\r\n        math.vec2.transformMat4(testPt, cameraPt, _mat4_temp);\r\n        testPt.x += this._anchorPoint.x * w;\r\n        testPt.y += this._anchorPoint.y * h;\r\n\r\n        if (testPt.x >= 0 && testPt.y >= 0 && testPt.x <= w && testPt.y <= h) {\r\n            if (listener && listener.mask) {\r\n                var mask = listener.mask;\r\n                var parent = this;\r\n                for (var i = 0; parent && i < mask.index; ++i, parent = parent.parent) {\r\n                }\r\n                // find mask parent, should hit test it\r\n                if (parent === mask.node) {\r\n                    var comp = parent.getComponent(cc.Mask);\r\n                    return (comp && comp.enabledInHierarchy) ? comp._hitTest(cameraPt) : true;\r\n                }\r\n                // mask parent no longer exists\r\n                else {\r\n                    listener.mask = null;\r\n                    return true;\r\n                }\r\n            }\r\n            else {\r\n                return true;\r\n            }\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n*/\r\n"]}