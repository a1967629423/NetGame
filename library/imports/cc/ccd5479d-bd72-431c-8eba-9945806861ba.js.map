{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\manage/assets\\script\\manage\\GameObjectManange.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\manage","sourcesContent":["import PrefabFactor from \"../../frame/PrefabFactory/PrefabFactory\";\r\nimport { SiteType, SiteLineType } from \"../Enums\";\r\nimport { SiteSM, SiteLineSM } from \"../site/SiteMachine\";\r\nimport { Vehicle } from \"../vehicle/VehicleMachine\";\r\nimport SitePeople from \"../site/SitePeople\";\r\nimport { SLDSM } from \"../site/SiteLine\";\r\nimport ScenesObject from \"../../utility/ScenesObject\";\r\nimport { LineRender } from \"../render/LineRender\";\r\nimport { SiteRender } from \"../render/SiteRender\";\r\nimport { LineClear } from \"./LineClearManage\";\r\nimport ObjectFactory from \"../../frame/ObjectPool/ObjectFactory\";\r\nimport { Path } from \"../Path/PathSM\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameObjectManage extends cc.Component {\r\n\r\n\r\n    private static _instance: GameObjectManage = null;\r\n    static get Instance(): GameObjectManage {\r\n        if (!this._instance) {\r\n            let ins = PrefabFactor.Instance\r\n            var node = new cc.Node('GameObjectManage');\r\n            var manage = node.addComponent(GameObjectManage);\r\n            var _keys = Object.keys(SiteLineType);\r\n            var keys: string[] = [];\r\n            _keys.forEach(value => { if (Number.parseFloat(value).toString() === 'NaN') { keys.push(value) } })\r\n            var count = keys.length - 1;\r\n            manage.lineCount = count;\r\n            for (var item = 0; item < count; item++) {\r\n                var type: number = SiteLineType[keys[item]];\r\n                manage.saveLineType.push(type);\r\n                manage.residueLineType.push(type);\r\n            }\r\n            this._instance = manage;\r\n            cc.director.getScene().addChild(node);\r\n        }\r\n        return this._instance;\r\n    }\r\n    vehicleCount: number = 2;\r\n    lineCount: number = 2;\r\n    saveLineType: SiteLineType[] = []\r\n    residueLineType: SiteLineType[] = []\r\n    GOCache: { Vehicle: boolean, Line: boolean, Site: boolean } = { Vehicle: false, Line: false, Site: false }\r\n    PathFactory: ObjectFactory<Path.VehiclePath> = null;\r\n    async getVehicle(nowProgress: number, line: Path.VehiclePath) {\r\n        var config = await PrefabFactor.LoadRes(PrefabFactor.prefabConfig);\r\n        if (config && config.json.vehicle && this.vehicleCount > 0) {\r\n            this.vehicleCount--;\r\n            var vehicle = await PrefabFactor.Instance.pop_path(config.json.vehicle.path)\r\n            if (!this.GOCache.Vehicle) this.GOCache.Vehicle = true;\r\n            if (vehicle) {\r\n                debugger;\r\n                var machine = vehicle.getComponent(Vehicle.VehicleMachine)\r\n                machine.nowProgress = nowProgress;\r\n                machine.line = line;\r\n                machine.nowSite = nowProgress === line.allLength ? line.nextSite : line.lastSite;\r\n                return machine;\r\n            }\r\n        }\r\n    }\r\n    getLineType(type: SiteLineType) {\r\n        var idx = this.residueLineType.findIndex(value => value === type)\r\n        if (idx > -1) {\r\n            this.lineCount--;\r\n            this.residueLineType.splice(idx, 1);\r\n        }\r\n    }\r\n    addLineType(type: SiteLineType) {\r\n        if (!this.saveLineType.findIndex(value => value === type)) {\r\n            this.lineCount++;\r\n            this.residueLineType.push(type);\r\n        }\r\n    }\r\n    getOperatorType(t: SiteLineType, last: SiteSM.SiteMachine, now: SiteSM.SiteMachine, next: SiteSM.SiteMachine) {\r\n        //0未知 1 增加 2 修改(中间跨越多个需要清除0) 3删除\r\n        var nowLine = now ? now.SiteLines.find(value => value.PathType === t) : null;\r\n        var nextLine = next ? next.SiteLines.find(value => value.PathType === t) : null;\r\n        //var lastLine = last?last.SiteLines.find(value=>value.LineType===t):null;\r\n        if (nowLine) {\r\n            if (nextLine) {\r\n                if (nextLine.isBegin || nextLine.isEnd || nowLine.isBegin || nowLine.isEnd) {\r\n                    return 3;\r\n                }\r\n            }\r\n            else if ((nowLine.nextSite===now&&nowLine.isEnd) || (nowLine.lastSite===now&&nowLine.isBegin)) {\r\n                return 1;\r\n            }\r\n            else {\r\n                return 2;\r\n            }\r\n        }\r\n        else if (!nextLine) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n\r\n\r\n    }\r\n    async CreateLine(nowSite: SiteSM.SiteMachine, nextSite: SiteSM.SiteMachine, type: SiteLineType) {\r\n        if (!this.PathFactory) this.PathFactory = new ObjectFactory<Path.VehiclePath>(true, Path.VehiclePath);\r\n        var line = this.PathFactory.pop(nowSite, nextSite, type);\r\n        if (line) {\r\n            nowSite.addLine(line);\r\n            nextSite.addLine(line);\r\n            return line;\r\n        }\r\n        return null;\r\n    }\r\n    async getLine(type: SiteLineType, lastSite: SiteSM.SiteMachine, nowSite: SiteSM.SiteMachine, endSite: SiteSM.SiteMachine): Promise<SLDSM.SiteLine> {\r\n        var operatorType = this.getOperatorType(type, lastSite, nowSite, endSite)\r\n        var nSL = nowSite.SiteLines.find(value => value.PathType === type && !(value.mask & 13));\r\n        var nextSl = endSite.SiteLines.find(value => value.PathType === type && !(value.mask & 13));\r\n        var LR = ScenesObject.instance.getComponentInChildren(LineRender.LineRenderStateMachine);\r\n        switch (operatorType) {\r\n            case 1:\r\n                //增加\r\n                var newPath = null\r\n                //如果当前选中的站点是线上的上的头站点则可以判断是向后连接\r\n                if(nSL&&nSL.lastSite===nowSite)\r\n                {\r\n                    newPath = await this.CreateLine(endSite, nowSite, type);\r\n                }\r\n                else\r\n                newPath = await this.CreateLine(nowSite, endSite, type);\r\n                if(this.residueLineType.some(v=>v===type))\r\n                {\r\n                    this.getLineType(type);\r\n                    var vehiclesNode = ScenesObject.instance.node.getChildByName('vehicles')\r\n                    var vehicle = await this.getVehicle(0, newPath);\r\n                    vehiclesNode.addChild(vehicle.node);\r\n                }\r\n                break;\r\n            case 2:\r\n                var nextPath = nSL.NextPath\r\n                var nextSite = nextPath.nextSite;\r\n                nextPath.mask|=15;\r\n                await this.CreateLine(endSite,nextSite,type);\r\n                await this.CreateLine(nowSite, endSite, type);\r\n                LR.updateRender();\r\n                LineClear.LineClearManage.Instance.updateClear();\r\n                break;\r\n            case 3:\r\n                nSL.mask |= 5;\r\n                LineClear.LineClearManage.Instance.updateClear();\r\n                \r\n                break;\r\n            case 4:\r\n\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        LR.updateRender();\r\n        return null\r\n\r\n    }\r\n    async getSite(stype: SiteType) {\r\n        var config = await PrefabFactor.LoadRes(PrefabFactor.prefabConfig);\r\n        if (config && config.json.site) {\r\n            var sites: [] = config.json.site;\r\n            var siteNode = await PrefabFactor.Instance.pop_path(sites[SiteType[stype]]);\r\n            if (!this.GOCache.Site) this.GOCache.Site = true;\r\n            var site = siteNode.getComponent(SiteSM.SiteMachine)\r\n            return site;\r\n        }\r\n        return null;\r\n    }\r\n    async getPeople(PeopleType: SiteType, Site: SiteSM.SiteMachine): Promise<SitePeople> {\r\n        var config = await PrefabFactor.LoadRes(PrefabFactor.prefabConfig);\r\n        if (config && config.json.people) {\r\n            var peoples: [] = config.json.people;\r\n            var people = await PrefabFactor.Instance.pop_path(peoples[SiteType[PeopleType]]);\r\n            if (people) {\r\n                var sp = people.getComponent(SitePeople)\r\n                sp.sourceSite = Site\r\n                return sp;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n    ScenesComponent: ScenesObject = null;\r\n    LineRenderMachine: LineRender.LineRenderStateMachine = null;\r\n    SiteRenderMachine: SiteRender.SiteRenderStateMachine = null;\r\n    start() {\r\n        this.ScenesComponent = ScenesObject.instance;\r\n        if (this.ScenesComponent) {\r\n            this.LineRenderMachine = this.ScenesComponent.getComponentInChildren(LineRender.LineRenderStateMachine);\r\n            this.SiteRenderMachine = this.ScenesComponent.getComponentInChildren(SiteRender.SiteRenderStateMachine);\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n    onDestroy() {\r\n        if (GameObjectManage._instance)\r\n            GameObjectManage._instance = null;\r\n    }\r\n}\r\n"]}