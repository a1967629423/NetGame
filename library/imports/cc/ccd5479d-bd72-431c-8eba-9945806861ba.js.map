{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\manage/assets\\script\\manage\\GameObjectManange.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\manage","sourcesContent":["import PrefabFactor from \"../../frame/PrefabFactory/PrefabFactory\";\r\nimport { SiteType, SiteLineType } from \"../Enums\";\r\nimport { SiteSM, SiteLineSM } from \"../site/SiteMachine\";\r\nimport { Vehicle } from \"../vehicle/VehicleMachine\";\r\nimport SitePeople from \"../site/SitePeople\";\r\nimport { SLDSM } from \"../site/SiteLine\";\r\nimport ScenesObject from \"../../utility/ScenesObject\";\r\nimport { LineRender } from \"../render/LineRender\";\r\nimport { SiteRender } from \"../render/SiteRender\";\r\nimport { LineClear } from \"./LineClearManage\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameObjectManage extends cc.Component {\r\n\r\n\r\n    private static _instance: GameObjectManage = null;\r\n    static get Instance(): GameObjectManage {\r\n        if (!this._instance) {\r\n            let ins = PrefabFactor.Instance\r\n            var node = new cc.Node('GameObjectManage');\r\n            var manage = node.addComponent(GameObjectManage);\r\n            var _keys = Object.keys(SiteLineType);\r\n            var keys: string[] = [];\r\n            _keys.forEach(value => { if (Number.parseFloat(value).toString() === 'NaN') { keys.push(value) } })\r\n            var count = keys.length - 1;\r\n            manage.lineCount = count;\r\n            for (var item = 0; item < count; item++) {\r\n                var type: number = SiteLineType[keys[item]];\r\n                manage.saveLineType.push(type);\r\n                manage.residueLineType.push(type);\r\n            }\r\n            this._instance = manage;\r\n            cc.director.getScene().addChild(node);\r\n        }\r\n        return this._instance;\r\n    }\r\n    vehicleCount: number = 3;\r\n    lineCount: number = 2;\r\n    saveLineType: SiteLineType[] = []\r\n    residueLineType: SiteLineType[] = []\r\n    GOCache: { Vehicle: boolean, Line: boolean, Site: boolean } = { Vehicle: false, Line: false, Site: false }\r\n    async getVehicle(nowSite: SiteSM.SiteMachine, nowProgress: number, line: SLDSM.SiteLine) {\r\n        var config = await PrefabFactor.LoadRes(PrefabFactor.prefabConfig);\r\n        if (config && config.json.vehicle && this.vehicleCount > 0) {\r\n            this.vehicleCount--;\r\n            var vehicle = await PrefabFactor.Instance.pop_path(config.json.vehicle.path)\r\n            if (!this.GOCache.Vehicle) this.GOCache.Vehicle = true;\r\n            if (vehicle) {\r\n                var machine = vehicle.getComponent(Vehicle.VehicleMachine)\r\n                machine.nowSite = nowSite;\r\n                machine.nowProgress = nowProgress;\r\n                machine.line = line;\r\n                return machine;\r\n            }\r\n        }\r\n    }\r\n    getLineType(type: SiteLineType) {\r\n        var idx = this.residueLineType.findIndex(value => value === type)\r\n        if (idx > -1) {\r\n            this.lineCount--;\r\n            this.residueLineType.splice(idx, 1);\r\n        }\r\n    }\r\n    addLineType(type: SiteLineType) {\r\n        if (!this.saveLineType.findIndex(value => value === type)) {\r\n            this.lineCount++;\r\n            this.residueLineType.push(type);\r\n        }\r\n    }\r\n    getOperatorType(t: SiteLineType, last: SiteSM.SiteMachine, now: SiteSM.SiteMachine, next: SiteSM.SiteMachine) {\r\n        //0未知 1 增加 2 修改(中间跨越多个需要清除0) 3删除\r\n        var nowLine = now ? now.SiteLines.find(value => value.LineType === t) : null;\r\n        var nextLine = next ? next.SiteLines.find(value => value.LineType === t) : null;\r\n        //var lastLine = last?last.SiteLines.find(value=>value.LineType===t):null;\r\n        if (nowLine) {\r\n            if (nextLine) {\r\n                if (nowLine.NextLine == nextLine) {\r\n                    if (nextLine.isEnd || nowLine.isBegin) {\r\n                        return 3;\r\n                    }\r\n                    else {\r\n                        return 0;\r\n                        //新加线\r\n                    }\r\n                }\r\n                else if (nowLine.LastLine == nextLine) {\r\n                    if (nowLine.isEnd || nextLine.isBegin) {\r\n                        return 3;\r\n                    }\r\n                    else {\r\n                        return 0;\r\n                    }\r\n                }\r\n                else {\r\n                    return 2;\r\n                }\r\n            }\r\n            else {\r\n                if (nowLine.isEnd) {\r\n                    return 1;\r\n                }\r\n                else if (nowLine.isBegin) {\r\n                    return 4;\r\n                }\r\n                else {\r\n                    return 2;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n\r\n\r\n    }\r\n    async CreateLine(lineName:string,Site:SiteSM.SiteMachine,type:SiteLineType)\r\n    {\r\n        var line = await PrefabFactor.Instance.pop_path(lineName,type);\r\n        if(line)\r\n        {\r\n            var Sl = line.getComponent(SLDSM.SiteLine);\r\n            if(Sl)\r\n            {\r\n                Site.addLine(Sl)\r\n                Sl.LineType = type;\r\n                Sl.addSiteLines()\r\n            }\r\n            return Sl;\r\n        }\r\n        return null;\r\n    }\r\n    async getLine(type: SiteLineType, lastSite: SiteSM.SiteMachine, nowSite: SiteSM.SiteMachine, endSite: SiteSM.SiteMachine): Promise<SLDSM.SiteLine> {\r\n        var config = await PrefabFactor.LoadRes(PrefabFactor.prefabConfig);\r\n        if (config && config.json.line) {\r\n            var operatorType = this.getOperatorType(type, lastSite, nowSite, endSite)\r\n            this.getLineType(type);\r\n            var lines: [] = config.json.line;\r\n            var nSL = nowSite.SiteLines.find(value => value.LineType === type);\r\n            var nextSl = endSite.SiteLines.find(value => value.LineType === type);\r\n            var lineName = lines['baseline'];\r\n            if (!nextSl) {\r\n                nextSl = await this.CreateLine(lineName,endSite,type);\r\n            }\r\n            if (!nSL) {\r\n                nSL = await this.CreateLine(lineName,nowSite,type)\r\n            }\r\n            if (!this.GOCache.Line) this.GOCache.Line = true;\r\n            let linesnode = ScenesObject.instance.node.getChildByName('lines');\r\n            switch (operatorType) {\r\n                case 1:\r\n                    //增加\r\n                    nSL.linkTo(nextSl);\r\n                    if(!nSL.node.parent)\r\n                    linesnode.addChild(nSL.node);\r\n                    linesnode.addChild(nextSl.node);\r\n                    nSL.node.position = nowSite.node.position;\r\n                    nSL.caculatePath();\r\n                    break;\r\n                case 2:\r\n                    //修改\r\n                    //连接原先两个点\r\n                    //一次删两个\r\n                    nSL.ChangeFlag = true;\r\n                    nSL.ClearFlag = true;\r\n                    var lastLine = nSL.LastLine;\r\n                    var nextLine = nSL.NextLine;\r\n                    nSL = nextSl;\r\n                    nSL.linkTo(nextLine);\r\n                    lastLine.linkTo(nSL);\r\n                    linesnode.addChild(nextSl.node);\r\n                    nextSl.node.position = endSite.node.position;\r\n                    lastLine.caculatePath();\r\n                    nSL.caculatePath();\r\n                    LineClear.LineClearManage.Instance.updateClear();\r\n                    break;\r\n                case 3:\r\n                    debugger;\r\n                    var removeLine:SLDSM.SiteLine = null;\r\n                    if (nSL.isEnd || nextSl.isBegin) {\r\n                        removeLine = nSL;\r\n                    }\r\n                    if (nSL.isBegin || nextSl.isEnd) {\r\n                        removeLine = nSL;\r\n                    }\r\n                    if(nSL.isEnd)\r\n                    {\r\n                        nSL.LastLine.HidenFlag=true;\r\n                    }\r\n                    removeLine.ClearFlag = true;\r\n                    var render = ScenesObject.instance.getComponentInChildren(LineRender.LineRenderStateMachine);\r\n                    if(render)\r\n                    {\r\n                        render.updateRender();\r\n                    }\r\n                    LineClear.LineClearManage.Instance.updateClear();\r\n\r\n                    break;\r\n                case 4:\r\n                    nextSl.linkTo(nSL);\r\n                    linesnode.addChild(nextSl.node);\r\n                    nextSl.node.position = endSite.node.position;\r\n                    nextSl.caculatePath();\r\n                    break;\r\n                //删除\r\n                default:\r\n                    break;\r\n            }\r\n            \r\n            return nSL;\r\n            // var LSm = await SiteLineSM.SiteLineMachine.getLM(nowSite,lastSite,endSite,type,Line);\r\n            // if(LSm)\r\n            // {\r\n            //     var siteline = Line.getComponent(SLDSM.SiteLine);\r\n            //     siteline.line = LSm;\r\n            //     var linesnode = ScenesObject.instance.node.getChildByName('lines');\r\n            //     linesnode.addChild(Line);\r\n            //     Line.position = nowSite.node.position;\r\n            //     return siteline\r\n            // }\r\n        }\r\n        return null\r\n\r\n    }\r\n    async getSite(stype: SiteType) {\r\n        var config = await PrefabFactor.LoadRes(PrefabFactor.prefabConfig);\r\n        if (config && config.json.site) {\r\n            var sites: [] = config.json.site;\r\n            var siteNode = await PrefabFactor.Instance.pop_path(sites[SiteType[stype]]);\r\n            if (!this.GOCache.Site) this.GOCache.Site = true;\r\n            var site = siteNode.getComponent(SiteSM.SiteMachine)\r\n            return site;\r\n        }\r\n        return null;\r\n    }\r\n    async getPeople(PeopleType: SiteType, Site: SiteSM.SiteMachine): Promise<SitePeople> {\r\n        var config = await PrefabFactor.LoadRes(PrefabFactor.prefabConfig);\r\n        if (config && config.json.people) {\r\n            var peoples: [] = config.json.people;\r\n            var people = await PrefabFactor.Instance.pop_path(peoples[SiteType[PeopleType]]);\r\n            if (people) {\r\n                var sp = people.getComponent(SitePeople)\r\n                sp.sourceSite = Site\r\n                return sp;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n    ScenesComponent: ScenesObject = null;\r\n    LineRenderMachine: LineRender.LineRenderStateMachine = null;\r\n    SiteRenderMachine: SiteRender.SiteRenderStateMachine = null;\r\n    start() {\r\n        this.ScenesComponent = ScenesObject.instance;\r\n        if (this.ScenesComponent) {\r\n            this.LineRenderMachine = this.ScenesComponent.getComponentInChildren(LineRender.LineRenderStateMachine);\r\n            this.SiteRenderMachine = this.ScenesComponent.getComponentInChildren(SiteRender.SiteRenderStateMachine);\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n    onDestroy() {\r\n        if (GameObjectManage._instance)\r\n            GameObjectManage._instance = null;\r\n    }\r\n}\r\n"]}