{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\Path/assets\\script\\Path\\PathSM.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\Path","sourcesContent":["import { SiteSM } from \"../site/SiteMachine\";\r\nimport ObjectPool, { IObpool } from \"../../frame/ObjectPool/ObjectPool\";\r\nimport { SiteLineType } from \"../Enums\";\r\nimport { Vehicle } from \"../vehicle/VehicleMachine\";\r\n/**\r\n * 载具路线类\r\n * 储存:所有线路，上一个以及下一个线路，处于线路上的载具，当前状态遮罩\r\n * 功能:获取此线路上的中间插值点\r\n */\r\nexport default class VehiclePath implements IObpool {\r\n    /**\r\n     * 当路线从对象池中取出之后会注册到此数组中\r\n     */\r\n    static allPath: VehiclePath[] = [];\r\n    unuse(value?: any) {\r\n        this.lastSite = null;\r\n        this.nextSite = null;\r\n        this.mask = 0;\r\n        var idx = -1;\r\n        this.allLength = 0;\r\n        this.changePoint = [];\r\n        if (VehiclePath.allPath.some((v, index) => {\r\n            if (v === this) {\r\n                idx = index;\r\n                return true;\r\n            }\r\n        })) {\r\n            VehiclePath.allPath.splice(idx);\r\n        }\r\n    }\r\n    reuse(lastSite: SiteSM.SiteMachine, nextSite: SiteSM.SiteMachine, Type: SiteLineType) {\r\n        this.lastSite = lastSite;\r\n        this.nextSite = nextSite;\r\n        this.PathType = Type;\r\n        VehiclePath.allPath.push(this);\r\n        this.caculatePath();\r\n    }\r\n    recycle(value?: any) {\r\n        ObjectPool.GlobalPush(this);\r\n    }\r\n    \r\n    lastSite: SiteSM.SiteMachine = null;\r\n    nextSite: SiteSM.SiteMachine = null;\r\n    /**\r\n     * 1111\r\n     * cdhb\r\n     * c:changed\r\n     * d:deleted\r\n     * h:hided\r\n     * b:blocked\r\n     */\r\n    mask: number = 0;\r\n    /**线的类型 */\r\n    PathType: SiteLineType = SiteLineType.red;\r\n    /**线的总长度 */\r\n    allLength: number = 0;\r\n    /**中转点 */\r\n    changePoint: { length: number, point: cc.Vec2, Radian: number }[] = [];\r\n    /**载具集合 */\r\n    vehicles: Vehicle.VehicleMachine[] = [];\r\n    caculatePath() {\r\n        cc.Vec2\r\n        var n = this.lastSite;\r\n        var e = this.nextSite;\r\n        var Line = this;\r\n        var { x, y, allLength, firstRadian, lastRadian, rectDir, rectH, rectW } = DMath.pathCalcaulate(n.node.x, n.node.y, e.node.x, e.node.y)\r\n        Line.allLength = allLength;\r\n        Line.changePoint = []\r\n        Line.changePoint.push({ length: rectDir ? rectW : rectH, point: cc.v2(x, y), Radian: firstRadian })\r\n        Line.changePoint.push({ length: allLength, point: e.node.position, Radian: lastRadian });\r\n    }\r\n    __np: cc.Vec2 = cc.v2();\r\n    /**\r\n     * 根据运行方向以及进度获取坐标，此坐标为站点集对象下的坐标\r\n     * @param progress 当前的进度(前进的距离)\r\n     * @param dir 运行的方向\r\n     */\r\n    getLocation(progress: number, dir: boolean = true): { position: cc.Vec2, radian: number } {\r\n        var nLine = this;\r\n        var narr = nLine.changePoint//dir?this.changPoint:this.rchangePoint\r\n        var nprogress = dir ? progress : nLine.allLength - progress;\r\n        var idx = narr.findIndex(value => value.length >= nprogress)\r\n        var cp = narr[idx]\r\n        var lastp = this.lastSite.node.position;\r\n        var nLenght = cp.length;\r\n        if (idx >= 1) {\r\n            lastp = narr[idx - 1].point;\r\n            nprogress -= narr[idx - 1].length\r\n            nLenght -= narr[idx - 1].length\r\n        }\r\n        if (!this.__np) this.__np = cc.v2();\r\n        lastp.lerp(cp.point, nprogress / nLenght, this.__np) //dir?lastp.lerp(cp.point,cl):cp.point.lerp(lastp,cl);\r\n        return { position: this.__np, radian: cp.Radian + (dir ? 0 : Math.PI) };\r\n    }\r\n    /**\r\n     * 当载具换线时需要注册\r\n     * @param v 载具\r\n     */\r\n    addVehicle(v: Vehicle.VehicleMachine) {\r\n        if (v instanceof Vehicle.VehicleMachine) {\r\n            this.vehicles.push(v);\r\n        }\r\n    }\r\n    /**\r\n     * 当载具离开时需要注销\r\n     * @param v 载具\r\n     */\r\n    removeVehicle(v: Vehicle.VehicleMachine) {\r\n        if (v instanceof Vehicle.VehicleMachine) {\r\n            var idx = this.vehicles.findIndex(value => value === v);\r\n            if (idx > -1)\r\n                this.vehicles.splice(idx);\r\n        }\r\n    }\r\n}\r\n"]}