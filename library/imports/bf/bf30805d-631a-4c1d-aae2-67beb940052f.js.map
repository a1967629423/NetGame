{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\manage/assets\\script\\manage\\ScoreManage.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\manage","sourcesContent":["export module Score\r\n{\r\n    export enum ScoreType\r\n    {\r\n        normal,people\r\n    }\r\n    export class ScoreEvent\r\n    {\r\n        static SCORE_CHANGE = 'ScoreChange';\r\n        static SCORE_ADD='ScoreAdd';\r\n        static SCORE_SUB='ScoreSub';\r\n    }\r\n    export class ScoreManage extends cc.Component {\r\n        private static _instance:{type:ScoreType,SM:ScoreManage}[] = [];\r\n        static getInstance(type:ScoreType)\r\n        {\r\n            var ii = this._instance.find(value=>value.type===type);\r\n            var result:ScoreManage = null;\r\n            if(ii)\r\n            {\r\n                if(ii.SM)\r\n                {\r\n                    result = ii.SM;\r\n                }\r\n                else\r\n                {\r\n                    var node = new cc.Node('ScoreManage');\r\n                    result=ii.SM=node.addComponent(ScoreManage);\r\n                    result.stype = type;\r\n                    node.setParent(cc.director.getScene());\r\n                }\r\n            }\r\n            else\r\n            {\r\n                var node = new cc.Node('ScoreManage');\r\n                result=node.addComponent(ScoreManage);\r\n                node.setParent(cc.director.getScene());\r\n                result.stype=type;\r\n                this._instance.push({type:type,SM:result});\r\n            }\r\n            return result;\r\n        }\r\n        private scoreCache:number[]=[]\r\n        nowScore:number = 0;\r\n        stype:ScoreType = ScoreType.normal;\r\n        addScore(score:number)\r\n        {\r\n            this.node.emit(ScoreEvent.SCORE_ADD,score);\r\n            this.scoreCache.push(score);\r\n        }\r\n        subScore(score:number)\r\n        {\r\n            this.node.emit(ScoreEvent.SCORE_SUB,score);\r\n            this.scoreCache.push(-score);\r\n        }\r\n        update()\r\n        {\r\n            if(this.scoreCache.length>0)\r\n            {\r\n                var Sum = 0;\r\n                while(this.scoreCache.length)\r\n                {\r\n                    Sum+=this.scoreCache.pop()\r\n                }\r\n                if(Sum!==0)\r\n                {\r\n                    var newScore = this.nowScore+Sum;\r\n                    this.node.emit(ScoreEvent.SCORE_CHANGE,newScore,this.nowScore);\r\n                    this.nowScore = newScore;\r\n                }\r\n            }\r\n        }\r\n        onDestroy()\r\n        {\r\n            var mi=ScoreManage._instance.find(value=>value.type===this.stype);\r\n            if(mi&&mi.SM)\r\n            {\r\n                mi.SM = null;\r\n            }\r\n        }\r\n    }\r\n    \r\n}\r\n"]}