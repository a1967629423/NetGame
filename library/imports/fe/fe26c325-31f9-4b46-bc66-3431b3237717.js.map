{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\render\\states/assets\\script\\render\\states\\lineRenderStates.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\render\\states","sourcesContent":["import { LineRender } from \"../LineRender\";\r\nimport { MSMDsc } from \"../../../frame/StateMachine/StateDec\";\r\nimport { SLDSM } from \"../../site/SiteLine\";\r\nimport { SiteLineType, ConvertRGBToColor } from \"../../Enums\";\r\nimport { Path } from \"../../Path/PathSM\";\r\nimport { IPSM } from \"../../../frame/InputManage\";\r\n\r\nconst {LineRenderState,LineRenderStateMachine}=LineRender;\r\nconst {mState,mDefaultState,mLinkTo}=MSMDsc\r\nconst {SiteLine}=SLDSM;\r\nexport module LineRenderStates\r\n{\r\n    type LineSave = {type:SiteLineType,node:SLDSM.SiteLine[]}[]\r\n    export class BaseRender extends LineRenderState\r\n    {\r\n        drawCache:LineSave = [];\r\n        draw()\r\n        {\r\n            var g = this.context.graphics;\r\n            var oldWidth = g.lineWidth;\r\n            g.lineWidth = this.context.lineWidth;\r\n            var drawedSite:LineSave = [];\r\n            this.drawCache = drawedSite;\r\n            g.clear();\r\n            var allPath = Path.VehiclePath.allPath;\r\n            allPath.forEach(v=>{\r\n                var color = ConvertRGBToColor(v.PathType);\r\n                g.strokeColor = color;\r\n                var firstPoint = v.changePoint[0].point;\r\n                g.moveTo(firstPoint.x,firstPoint.y);\r\n                for(var i = 1;i<v.changePoint.length;i++)\r\n                {\r\n                    var np = v.changePoint[i].point;\r\n                    g.lineTo(np.x,np.y);\r\n                }\r\n                g.stroke();\r\n            })\r\n            g.lineWidth=oldWidth;\r\n            \r\n        }\r\n    }\r\n    \r\n    @mDefaultState\r\n    @mLinkTo('DragLine','drag')\r\n    @mState('Default',LineRenderStateMachine)\r\n    export class Default extends BaseRender\r\n    {\r\n        touch()\r\n        {\r\n            this.context.emit('drag');\r\n        }\r\n        updateRender()\r\n        {\r\n            this.draw();\r\n        }\r\n    }\r\n    const {ConvertInputPointToWorld}=IPSM\r\n    @mLinkTo('Default','dragEnd')\r\n    @mState('DragLine',LineRenderStateMachine)\r\n    export class DragLine extends BaseRender\r\n    {\r\n        nG:cc.Graphics  = null;\r\n        firstPath:Path.VehiclePath = null;\r\n        secondPath:Path.VehiclePath = null;\r\n        renderPaths:Path.VehiclePath[]=[];\r\n        stateEnd()\r\n        {\r\n            this.context.emit('dragEnd');\r\n            this.context.dropGraphics(this.nG)\r\n        }\r\n        touchEnd()\r\n        {\r\n            this.stateEnd();\r\n        }\r\n        touchCancel()\r\n        {\r\n            this.stateEnd();\r\n        }\r\n        touch(t:cc.Touch)\r\n        {\r\n            if(this.firstPath)\r\n            {\r\n                var fp = this.firstPath;\r\n                var sp = this.secondPath\r\n                var location = this.context.node.convertToNodeSpaceAR(ConvertInputPointToWorld(t.getLocation(),this.context.node));\r\n\r\n                fp.setPoint(fp.beginPoint,location);\r\n                sp.setPoint(location,sp.endPoint);\r\n\r\n            }\r\n        }\r\n        draw()\r\n        {\r\n            if(this.nG)\r\n            {\r\n                var g = this.nG\r\n                g.clear();\r\n                this.renderPaths.forEach(p=>{\r\n                    var changePoint = p.changePoint;\r\n                    changePoint.forEach((v,idx)=>{\r\n                        if(idx===0){g.moveTo(v.point.x,v.point.y);return;}\r\n                        g.lineTo(v.point.x,v.point.y);\r\n                    });\r\n                    g.stroke();\r\n                })\r\n            }\r\n        }\r\n        update()\r\n        {\r\n            this.draw();   \r\n        }\r\n        Quit()\r\n        {\r\n            if(this.firstPath)this.firstPath.recycle();\r\n            if(this.secondPath)this.secondPath.recycle();\r\n            this.renderPaths = [];\r\n        }\r\n        Start()\r\n        {\r\n            this.nG = this.context.createGraphics(this.context.graphics);\r\n            if(this.nG&&this.context._HitedLine)\r\n            {\r\n                this.firstPath = this.context._HitedLine.copy();\r\n                this.secondPath = this.context._HitedLine.copy();\r\n                this.renderPaths = [this.firstPath,this.secondPath];\r\n                this.nG.lineWidth = this.context.lineWidth;\r\n                var color = ConvertRGBToColor(this.firstPath.PathType).clone();\r\n                color.setA(125);\r\n                this.nG.strokeColor = color;\r\n            }\r\n            else\r\n            {\r\n                this.stateEnd();\r\n            }\r\n            \r\n        }\r\n    }\r\n}"]}