{"version":3,"sources":["SitePeople.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\site","sourcesContent":["import { SiteType } from \"../Enums\";\r\nimport { Vehicle } from \"../vehicle/VehicleMachine\";\r\nimport { SiteSM, SiteLineSM } from \"./SiteMachine\";\r\nimport { SLDSM } from \"./SiteLine\";\r\nimport ObjectPool, { IObpool, IOFPool } from \"../../frame/ObjectPool/ObjectPool\";\r\nimport { Score } from \"../manage/ScoreManage\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SitePeople extends cc.Component implements IObpool {\r\n    unuse() {\r\n        Score.ScoreManage.getInstance(Score.ScoreType.people).addScore(1);\r\n    }\r\n    reuse() {\r\n\r\n    }\r\n    recycle(value: any) {\r\n\r\n    }\r\n    // LIFE-CYCLE CALLBACKS:\r\n    // onLoad () {}\r\n    @property({ type: cc.Enum(SiteType) })\r\n    peopleType: SiteType = SiteType.rect\r\n    sourceSite: SiteSM.SiteMachine = null\r\n    start() {\r\n    }\r\n    GetInVehicle(vehicle: Vehicle.VehicleMachine): boolean {\r\n        var dir = vehicle.rundir;\r\n        var nowLine = vehicle.line;\r\n        var nextLine = dir ? nowLine.NextLine : nowLine.LastLine;\r\n        var hastOtherLineSite: SLDSM.SiteLine[] = []\r\n        while (nextLine) {\r\n            if (nextLine.NowSite.SiteType === this.peopleType && nextLine.NowSite !== this.sourceSite) {\r\n                return true;\r\n            }\r\n            if (nextLine.NowSite.SiteLines.find(value => value.LineType != nowLine.LineType)) {\r\n                hastOtherLineSite.push(nextLine);\r\n            }\r\n            nextLine = dir ? nextLine.NextLine : nextLine.LastLine;\r\n        }\r\n        //到终点都没有\r\n        for (var i in hastOtherLineSite) {\r\n            var value = hastOtherLineSite[i];\r\n            var next = value.NextLine;\r\n            while (next) {\r\n                if (next.NowSite.SiteType === this.peopleType&&next.NowSite!==this.sourceSite) {\r\n                    console.log('要去转车')\r\n                    return true;\r\n                }\r\n                next = next.NextLine;\r\n            }\r\n            var last = value.LastLine;\r\n            while (last) {\r\n                if (last.NowSite.SiteType === this.peopleType&&last.NowSite!==this.sourceSite) {\r\n                    console.log('要去转车')\r\n                    return true\r\n                }\r\n                last = last.LastLine\r\n            }\r\n\r\n        }\r\n        return false;\r\n    }\r\n    GetOffVehicle(vehicle: Vehicle.VehicleMachine): boolean {\r\n        var dir = vehicle.rundir;\r\n        var nowLine = vehicle.line;\r\n        if (nowLine.NowSite.SiteType === this.peopleType) return true;\r\n        var nextLine = dir ? nowLine.NextLine : nowLine.LastLine;\r\n        var ni =0;\r\n        var oni = 0;\r\n        var oli = 0;\r\n        var mainHave = false;\r\n        var otherHave = false;\r\n        while (nextLine) {\r\n            if (nextLine.NowSite.SiteType === this.peopleType&&nextLine.NowSite!=this.sourceSite) {\r\n                mainHave = true;\r\n                break\r\n            }\r\n            ni++;\r\n            nextLine = dir ? nextLine.NextLine : nextLine.LastLine;\r\n        }\r\n        for (var i in nowLine.NowSite.SiteLines) {\r\n            var value = nowLine.NowSite.SiteLines[i]\r\n            if (value.LineType !== nowLine.LineType) {\r\n                var next = value.NextLine\r\n                while (next) {\r\n                    if (next.NowSite.SiteType === this.peopleType) {\r\n                        console.log('转车')\r\n                        otherHave = true;\r\n                        break\r\n                    }\r\n                    oni++;\r\n                    next = next.NextLine;\r\n                }\r\n                var last = value.LastLine;\r\n                if (last) {\r\n                    if (last.NowSite.SiteType === this.peopleType) {\r\n                        console.log('转车')\r\n                        otherHave = true;\r\n                        break\r\n                    }\r\n                    oli++;\r\n                    last = last.LastLine;\r\n                }\r\n\r\n            }\r\n        }\r\n        if(mainHave&&otherHave)\r\n        {\r\n            if(mainHave&&(ni<=oni||ni<=oli))\r\n            {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        else\r\n        {\r\n            if(otherHave)\r\n            {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n    // update (dt) {}\r\n}\r\n"]}