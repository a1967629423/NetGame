{"version":3,"sources":["SiteLineDispalyStates.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\site\\State","sourcesContent":["import { SLDSM } from \"../SiteLine\";\r\nimport { MSMDsc } from \"../../../frame/StateMachine/StateDec\";\r\nimport { SiteLineType } from \"../../Enums\";\r\nimport { MSM } from \"../../../frame/StateMachine/StateMachine\";\r\nimport PrefabFactor from \"../../../frame/PrefabFactory/PrefabFactory\";\r\nimport GameObjectManage from \"../../manage/GameObjectManange\";\r\nimport ScenesObject from \"../../../utility/ScenesObject\";\r\nimport ScenesManage from \"../../../frame/ScenesManage\";\r\nimport { LineRender } from \"../../render/LineRender\";\r\n\r\nconst {mState,mDefaultState,mLinkTo} =MSMDsc;\r\nexport module SLDSMStates {\r\n    @mDefaultState\r\n    @mLinkTo('Cleared','cleared')\r\n    @mLinkTo('Caculated','caculated')\r\n    @mState('Default',SLDSM.SiteLine)\r\n    export class Default extends SLDSM.SiteLineDisplayState {\r\n        static asyncLock = true;\r\n        async testVehicle()\r\n        {\r\n            Default.asyncLock = false;\r\n            if(this.context.nowTypeVehicle.length==0)\r\n            {\r\n                if (this.context.isBegin) {\r\n                    var vechicle = await GameObjectManage.Instance.getVehicle(this.context.NowSite, 0.1, this.context)\r\n                    if (vechicle) {\r\n                        var vehicles = ScenesObject.instance.node.getChildByName('vehicles');\r\n                        vehicles.addChild(vechicle.node);\r\n                        this.context.registerVehicle(vechicle);\r\n                    }\r\n                }\r\n            }\r\n            Default.asyncLock = true;\r\n        }\r\n        async Start()\r\n        {\r\n            if(!Default.asyncLock)\r\n            {\r\n                await this.context.AwaitUntil(()=>{\r\n                    return Default.asyncLock\r\n                })\r\n            }\r\n            await this.testVehicle();\r\n        }\r\n        update()\r\n        {\r\n            \r\n        }\r\n    }\r\n    @mLinkTo('Default','drawEnd')\r\n    @mState('Caculated',SLDSM.SiteLine)\r\n    export class Caculated extends SLDSM.SiteLineDisplayState\r\n    {\r\n        Start()\r\n        {\r\n            //this.drawPath();\r\n            var render = ScenesObject.instance.getComponentInChildren(LineRender.LineRenderStateMachine);\r\n            if(render)\r\n            {\r\n                render.updateRender();\r\n            }\r\n            this.context.emit('drawEnd');\r\n        }\r\n    }\r\n    \r\n    @mLinkTo('Default','changeEnd')\r\n    @mState('Change',SLDSM.SiteLine)\r\n    export class Change extends SLDSM.SiteLineDisplayState\r\n    {\r\n        Start()\r\n        {\r\n        }\r\n    }\r\n    \r\n    @mLinkTo('Removed','removed')\r\n    @mState('Cleared',SLDSM.SiteLine)\r\n    export class Cleared extends SLDSM.SiteLineDisplayState\r\n    {\r\n        Start()\r\n        {\r\n            // var next = this.context.NextLine\r\n            this.context.removeFromSitelines();\r\n            this.context.NowSite.removeLine(this.context);\r\n            debugger;\r\n            if(this.context.LastLine&&this.context.LastLine.NextLine===this.context)\r\n            {\r\n                //从后往前删除\r\n                this.context.LastLine.NextLine = null;\r\n                this.context.LastLine.changPoint = [];\r\n            }\r\n            else if(this.context.NextLine.LastLine === this.context)\r\n            {\r\n                //从前往后删除\r\n                this.context.NextLine.LastLine = null;\r\n            }\r\n            if(this.context.changPoint.length==0)\r\n            {\r\n                this.context.LastLine.HidenFlag = false;\r\n                PrefabFactor.NodePush(this.context.node)\r\n            }\r\n            this.context.NextLine = null;\r\n            this.context.LastLine = null;\r\n            this.context.changPoint = []\r\n            var render = ScenesObject.instance.getComponentInChildren(LineRender.LineRenderStateMachine);\r\n            if(render)\r\n            {\r\n                render.updateRender();\r\n            }\r\n            this.context.ClearFlag = false;\r\n            //this.context.emit('start');\r\n\r\n            //this.context.NowSite.removeLine(this.context)\r\n            // if(next)\r\n            // {\r\n            //     if(next.isEnd)\r\n            //     {\r\n            //         next.NowSite.removeLine(next);\r\n            //         PrefabFactor.NodePush(next.node);\r\n            //     }\r\n            //     else\r\n            //     {\r\n            //         next.LastLine = null;\r\n            //     }\r\n            // }\r\n            //this.context.emit('removed')\r\n            // this.context.startCoroutine_Auto((function*(_this){\r\n            //     while(_this.vehicles.length>0)\r\n            //     {\r\n            //         yield MSM.AwaitNextUpdate.getInstance(2);\r\n            //     }\r\n            //     //_this.NowSite.removeLine(this);\r\n            //     //_this.LastLine = null;\r\n\r\n            //     _this.emit('removed');\r\n            // })(this.context));\r\n        }\r\n    }\r\n    @mState('Removed',SLDSM.SiteLine)\r\n    export class Removed extends SLDSM.SiteLineDisplayState\r\n    {\r\n        Start()\r\n        {\r\n            //不显示的节点就移除\r\n            debugger;\r\n\r\n            this.context.emit('start');\r\n        }\r\n    }\r\n\r\n}\r\n"]}