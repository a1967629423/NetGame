{"version":3,"sources":["SiteStates.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\site\\State","sourcesContent":["import { SiteSM } from \"../SiteMachine\";\r\nimport { MSMDsc } from \"../../../frame/StateMachine/StateDec\";\r\nimport { MSM } from \"../../../frame/StateMachine/StateMachine\";\r\nimport GameObjectManage from \"../../manage/GameObjectManange\";\r\nimport { SiteLineType, SiteType } from \"../../Enums\";\r\nimport SitePeople from \"../SitePeople\";\r\nimport PrefabFactor from \"../../../frame/PrefabFactory/PrefabFactory\";\r\nconst {mDefaultState,mLinkTo,mState}=MSMDsc\r\nexport module SiteStates {\r\n    @mDefaultState\r\n    @mState('Default',SiteSM.SiteMachine)\r\n    export class Default extends SiteSM.SiteState {\r\n        checkType(type:number,result:MSM.OperatorStruct<boolean>,dir:boolean)\r\n        {\r\n            if(!result.operatorValue)\r\n            {\r\n                this.context.SiteLines.forEach(value=>{\r\n                    //if(value!=this.context.)\r\n                    //value.checkType(type,result,true);\r\n                    //value.checkType(type,result,false);\r\n                })\r\n            }\r\n        }\r\n        update(dt)\r\n        {\r\n\r\n        }\r\n        touch(t:cc.Touch)\r\n        {      \r\n        }\r\n        touchStart(t:cc.Touch)\r\n        {\r\n        }\r\n        async InitPoeple(people?:SitePeople)\r\n        {\r\n            if(!people)\r\n            {\r\n                //随机生成人物\r\n                var len = Object.keys(SiteType).length-1\r\n                var i =Math.floor(Math.random()*len)\r\n                people = await GameObjectManage.Instance.getPeople(i,this.context);\r\n            }\r\n            else\r\n            {\r\n                console.log(people);\r\n            }\r\n            \r\n            if(!people.node.parent)\r\n            {\r\n                this.context.node.addChild(people.node);\r\n                this.context.SitePeople.push(people);\r\n            }\r\n            else\r\n            {\r\n                console.log('have parent');\r\n            }\r\n        }\r\n        loadingPoeple(result: MSM.OperatorStruct<SitePeople>)\r\n        {\r\n            this.context.SitePeople.splice(this.context.SitePeople.findIndex(value=>result.operatorValue===value),1);\r\n            //result.operatorValue.node.removeFromParent();\r\n            this.context.node.removeChild(result.operatorValue.node);\r\n            console.log('loaded a people');\r\n        }\r\n        pushPeople(people: MSM.OperatorStruct<SitePeople>)\r\n        {\r\n            var p = people.operatorValue;\r\n            if(!p&&CC_DEBUG)\r\n            {\r\n                debugger;\r\n            }\r\n            if(p.peopleType===this.context.SiteType)\r\n            {\r\n                PrefabFactor.NodePush(p.node);\r\n            }\r\n            else\r\n            {\r\n                console.log('转站')\r\n                this.InitPoeple(p);\r\n            } \r\n            console.log('push a people')\r\n        }\r\n        Start()\r\n        {\r\n            this.context.startCoroutine_Auto((function*(_this){\r\n                while(true)\r\n                {\r\n                    yield MSM.AwaitNextSecond.getInstance(8);\r\n                    if(Math.random()>0.5)\r\n                    {\r\n                        _this.InitPoeple();\r\n                    }\r\n                }\r\n            })(this))\r\n        }\r\n        async touchCancel(t:cc.Touch)\r\n        {\r\n            var __pool = SiteSM.SiteMachine.SiteMachines\r\n            for(var f in __pool)\r\n            {\r\n                var value = __pool[f].node;\r\n                if(value.activeInHierarchy)\r\n                {\r\n                    if(value['_hitTest'](t.getLocation()))\r\n                    {\r\n                        var next = value.getComponent(SiteSM.SiteMachine);\r\n                        var type = 0;\r\n                        if(this.context.SiteLines.length>0)\r\n                        {\r\n                            //站点上有线默认就使用第一个\r\n                            type = this.context.SiteLines[0].PathType\r\n                        }\r\n                        else\r\n                        {\r\n                            //站点没线默认使用剩下的第一个\r\n                            if(GameObjectManage.Instance.lineCount>0)\r\n                            type = GameObjectManage.Instance.residueLineType[0];\r\n                            else\r\n                            return\r\n                        }\r\n                        var nLine = this.context.SiteLines.find(value=>value.PathType===type&&value.nextSite===this.context&&!(value.mask&13));\r\n                        var lastSite = nLine&&nLine.lastSite;\r\n                        var line = await GameObjectManage.Instance.getLine(type,lastSite,this.context,next);\r\n                        if(line)\r\n                        {\r\n                            //this.context.SiteLines.push(line.line);\r\n                            //next.SiteLines.push(line.line);\r\n                            //this.context.node.addChild(line.node);\r\n                            break;\r\n                        }\r\n                        if(CC_DEBUG)\r\n                        {\r\n                            console.log('line add')\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n"]}