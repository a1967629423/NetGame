{"version":3,"sources":["CameraMoveStates.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\utility\\cameraMove\\States","sourcesContent":["import { CameraMoveMachine } from \"../CameraMoveMachine\";\r\nimport { MSMDsc } from \"../../../frame/StateMachine/StateDec\";\r\n\r\nexport  module CameraMoveStates\r\n{\r\n    \r\n    @MSMDsc.mDefaultState\r\n    @MSMDsc.mLinkTo('Pause','pause')\r\n    @MSMDsc.mLinkTo('Scale','scale')\r\n    @MSMDsc.mState('Default',CameraMoveMachine.CameraMoveMachine)\r\n    export class DefaultState extends CameraMoveMachine.CameraMoveState\r\n    {\r\n        lastScrollY:number = 1;\r\n        Start()\r\n        {\r\n            this.context.listen('pause');\r\n            this.lastScrollY = 1;\r\n        }\r\n        touchEnd(t:cc.Touch)\r\n        {\r\n            this.context.touchExit(t);\r\n        }\r\n        touchCancel(t:cc.Touch)\r\n        {\r\n            this.context.touchExit(t);\r\n        }\r\n        touch(t:cc.Touch)\r\n        {\r\n            var nid = t.getID();\r\n            if(!this.context.touchs.find(value=>value.id===nid))\r\n            {\r\n                this.context.touchs.push({id:nid,point:t.getLocation()})\r\n            }\r\n            if(this.context.touchs.length>1)\r\n            {\r\n                this.context.emit('scale')\r\n            }\r\n            else\r\n            {\r\n                var add = t.getDelta().neg().mul(1/this.context.nCamera.zoomRatio);\r\n                this.context.node.position=this.context.node.position.add(add);\r\n            }\r\n        }\r\n        \r\n        mouseWheel(mouseEvent:cc.Event.EventMouse)\r\n        {\r\n            this.lastScrollY += mouseEvent.getScrollY()/1200\r\n            this.lastScrollY = this.context.changeCameraZoom(this.lastScrollY);\r\n        }\r\n        Quit()\r\n        {\r\n            this.lastScrollY = 1;\r\n            this.context.cancelListen('pause');\r\n        }\r\n    }\r\n    \r\n    @MSMDsc.mLinkTo('Default','resume')\r\n    @MSMDsc.mState('Pause',CameraMoveMachine.CameraMoveMachine)\r\n    export class PauseState extends CameraMoveMachine.CameraMoveState\r\n    {\r\n        Start()\r\n        {\r\n            this.context.listen('resume')\r\n        }\r\n        Quit()\r\n        {\r\n            this.context.cancelListen('resume')\r\n        }\r\n    }\r\n    \r\n    @MSMDsc.mLinkTo('Default','exit')\r\n    @MSMDsc.mState('Scale',CameraMoveMachine.CameraMoveMachine)\r\n    export class ScaleState extends CameraMoveMachine.CameraMoveState{\r\n        nscale:number=null;\r\n        touchExit(t:cc.Touch)\r\n        {\r\n            if(this.context.touchs.length<=1)\r\n            {\r\n                this.context.emit('exit');\r\n            } \r\n        }\r\n        touchCancel(t:cc.Touch)\r\n        {\r\n            this.context.touchExit(t);\r\n        }\r\n        touchEnd(t:cc.Touch)\r\n        {\r\n            this.context.touchExit(t);\r\n        }\r\n        touch(t:cc.Touch)\r\n        {\r\n            var nid = t.getID();\r\n            var savetouch = this.context.touchs.find(value=>value.id===nid)\r\n            if(!savetouch)\r\n            {\r\n                this.context.touchs.push({id:nid,point:t.getLocation()})\r\n            }\r\n            else\r\n            {\r\n                savetouch.point = t.getLocation();\r\n            }\r\n            if(this.context.touchs.length>1)\r\n            {\r\n                var sub = this.context.touchs[0].point.sub(this.context.touchs[1].point).mag()\r\n                if(!this.nscale)\r\n                {\r\n                    this.nscale = sub;\r\n                }\r\n                var add = sub-this.nscale;\r\n                var nextRatio = this.context.nCamera.zoomRatio+(add/1000)\r\n                this.context.changeCameraZoom(nextRatio);\r\n                this.nscale = sub;\r\n            }\r\n        }\r\n        Quit()\r\n        {\r\n            this.nscale = null;\r\n        }\r\n    }\r\n}"]}